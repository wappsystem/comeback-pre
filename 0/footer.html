<div id=D__ID>
    <div id=footer__ID> 
        <form id=F__ID>
            <hr>
            <div class="row">
                <div class="col-lg-5 col-sm-10 col-lg-height no-padding">
                    <div class="split-box-content";>
                        <div class='mains__ID' style= 'text-align:left;margin-left:5%'>
                            <p class=fontem >Connect with us.</p>
                            <input class="form-control form-control-lg" style='background-color: transparent;border-bottom: 1px solid black;' type="text" placeholder="Email Address" id=email_address__ID name=email_address >
                            <div class=row>
                                <div  class="col-lg-3">
                                    <button id=submit__ID type="submit" class="btn" >SUBMIT <img src="m/images/right-arrow-black.png"  ></img></button>
                                </div>
                                <div   class="col-lg-9">
                                    <p class=fontems style='padding-top:7px'>By signing up, you agree to receive emails from Comeback and agree to our terms of use and privacy policy.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
<!--                <div class='col-lg-1 col-sm-2'>
                    <div class='mains__ID' style= 'text-align:left;margin-left:5%'>
                        <p class=fontem >&nbsp;</p>
                        <button id=submit__ID type="submit" class="btn" ><img src="m/images/right-next.png"  ></img></button>
                    </div>
                </div>-->
                <div class="col-lg-3 col-sm-12 col-lg-height no-padding">
                    <div class=vlf></div>
                    <div class="split-box-content";>
                        <div class='mains__ID' style= 'text-align:left;margin-left:5%'>
                            <a class=fontfot href='https://www.facebook.com/facebookapp' target=_blank >THE CAMPAIGN</a><br>
                            <a class=fontfot href='https://www.instagram.com/comebackyourway/?hl=en' target=_blank >THE CREATORS</a><br>
                            <a class=fontfot href='https://www.instagram.com/comebackyourway/?hl=en' target=_blank >THE COMMUNITY</a><br>
                            <a class=fontfot href='https://www.facebook.com/facebookapp' target=_blank >CONTACT</a><br>
                            <p class=fontfot >&nbsp;</p>
                            <p class=fontfot >&nbsp;</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-12 col-lg-height no-padding">
                    <div class=vlf></div>
                    <div class="split-box-content";>
                        <div class='mains__ID' style= 'text-align:left;margin-left:5%'>
                            <a class=fontfot href='https://www.instagram.com/comebackyourway/?hl=en' target=_blank >INSTAGRAM</a><br>
                            <a class=fontfot href='https://www.facebook.com/facebookapp' target=_blank  >FACEBOOK</a><br>
                            <p class=fontfot >&nbsp;</p>
                            <p class=fontfot >&nbsp;</p>
                            <a ><img class='img-fluid' src="m/images/logo-black-small.png" ></img></a>
                            <p class=fontfot >ALL RIGHTS RESERVED</p>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <script>
      	function F__ID(){
            //-------------------------------------
            var m=$vm.module_list['__MODULE__'];
            if(m.prefix==undefined) m.prefix="";
            if(m.change_status==undefined) m.change_status=0;
            //-------------------------------------
            var before_submit;
            m.load=function(){
                //$('#D__ID').scrollTop(0);
                //$(window).scrollTop(0);
                //$('#F__ID')[0].reset();
                $('#submit__ID').show();
                $('#delete__ID').hide(); if(m.input!=undefined && m.input.record!=undefined && m.input.record._id!==undefined) $('#delete__ID').show();
                if(m.input!=undefined) $vm.deserialize(m.input.record,'#F__ID');
                before_submit = m.before_submit;
            }
            //-------------------------------
            m.set_file_link=function(tag){
                $('#link_'+tag+'__ID').html("");
                $('#x_'+tag+'__ID').hide();
                var record=m.input.record;
                if(record==undefined) return;
                var filename=record.Data[tag];
                if(filename==undefined){
                    filename="";
                }
                else{
                    $('#x_'+tag+'__ID').show();
                }
                $('#link_'+tag+'__ID').html(filename);
                var url=record.Table+"/"+record.UID+"-"+tag+"-"+filename;
                $('#link_'+tag+'__ID').on('click',function(){
                    if(record._id!==undefined){
                        if(filename!="") $vm.open_s3_url(record._id,m.Table,filename,url);
                    }
                    else alert("No file was found on server.")
                });
                $('#x_'+tag+'__ID').on('click',function(){
                    $('#link_'+tag+'__ID').html('');
                    $('#x_'+tag+'__ID').hide();
                    record.Data[tag]="";
                })
            }
            //-------------------------------
            m.set_image_url=function(tag){
                $obj=$('#'+tag+'__ID');
                $obj.attr('src',"");
                $('#x_'+tag+'__ID').hide();
                var record=m.input.record;
                if(record==undefined) return;
                var filename=record.Data[tag];
                if(filename==undefined || filename==""){
                    return;
                }
                else{
                    $('#x_'+tag+'__ID').show();
                }
                var modified=record.Update_date;
                if(modified==undefined) modified=record.Submit_date;
                
                var img_id='img_'+tag+'_'+record._id;
                if(m[img_id]!=undefined) $obj.attr('src',m[img_id]);
                else{
                    var img_url				=localStorage.getItem(img_id+"_url");
                    var img_last_load_date	=localStorage.getItem(img_id+"_last_load_date");
                    var img_modified		=localStorage.getItem(img_id+"_modified");
                    var D1=new Date();
                    var D0=new Date(img_last_load_date);
                    var dif=D1.getTime()-D0.getTime();
                    dif=dif/1000/3600/24;
                    if(img_url!==null && dif<6 && img_modified==modified){
                        m[img_id]=img_url;
                        $obj.attr('src',img_url);
                    }
                    else{
                        var expires=7*24*3600;
                        var url=record.Table+"/"+record.UID+"-"+tag+"-"+filename;
                        $vm.request({cmd:"s3_download_url",id:record._id,table:record.Table,filename:filename,url:url,expires:expires},function(res){
                            if(res.status=="np"){
                                alert("No permission.")
                                return;
                            }
                            m[img_id]=res.result;
                            $obj.attr('src',res.result);
                            localStorage.setItem(img_id+"_url",res.result);
                            localStorage.setItem(img_id+"_last_load_date",new Date().toString());
                            localStorage.setItem(img_id+"_modified",modified);
                        });
                    }
                }
                $('#x_'+tag+'__ID').on('click',function(){
                    $obj.attr('src',"");
                    $('#x_'+tag+'__ID').hide();
                    record.Data[tag]="";
                })
            }
            //-------------------------------
            m.submit=function(event){
                //--------------------------------------------------------
                event.preventDefault();
                $('#submit__ID').hide();
                //--------------------------------------------------------
                var data={};
                var index={};
                var data_new=$vm.serialize('#F__ID');
                if(m.input!=undefined && m.input.record!=undefined){
                    for(k in m.input.record.Data){
                        data[k]=m.input.record.Data[k];
                    }
                }
                if(data_new!=undefined){
                    for(k in data_new){
                        data[k]=data_new[k];
                    }
                }
                delete data[""];
                var file=$vm.serialize_file('#F__ID');
                var FN=0; $('#F__ID').find('input[type=file]').each(function(evt){ if(this.files.length==1) FN++; });
                var r=true;
                if(m.before_submit!=undefined) r=m.before_submit(data,index);
                if(r==false){$('#submit__ID').show(); return;}
                //--------------------------------------------------------
                var rid=undefined; if(m.input!=undefined && m.input.record!=undefined) rid=m.input.record._id;
                if(rid==undefined){
                    var i_cmd="insert";
                    if(m.cmd_type=='table') i_cmd='insert-table';
                    $vm.request({cmd:i_cmd,table:m.Table,data:data,index:index,file:file},function(res){
                        if(res.status=="np"){
                            alert("No permission to insert a new record in to the database.");
                            if(m.input!=undefined && m.input.goback!=undefined){
                                $vm.refresh=1;
                                window.history.go(-1);       //from grid
                            }
                            return;
                        }
                        var after_submit=function(){
                            if(m.after_insert!=undefined){
                                m.after_insert(data,res); return;
                            }
                            $vm.refresh=1;
                            //if(m.change_status==undefined) m.change_status=0;
                            m.change_status++;
                            if(m.input.goback!=undefined) window.history.go(-1);            //from grid
                            else $vm.alert('Your data has been successfully submitted');    //standalone
                        }
                        if(FN==0) after_submit();
                        else{
                            open_model__ID();
                            $vm.upload_form_files(res,$('#F__ID'),"msg__ID",function(){
                                close_model__ID();
                                after_submit();
                            })
                        }
                        //-----------------------------
                    });
                }
                else if(rid!=undefined){
                    var cmd="update";
                    if(m.cmd_type=='p1') cmd='update-p1';
                    if(m.cmd_type=='p2') cmd='update-p2';
                    if(m.cmd_type=='table') cmd='update-table';
                    $vm.request({cmd:cmd,id:rid,table:m.Table,data:data,index:index,file:file},function(res){
                        //-----------------------------
                        if(res.status=="lk"){
                            $vm.alert("This record is locked.");
                            return;
                        }
                        //-----------------------------
                        if(res.status=="np"){
                            alert("No permission to update this record.");
                            return;
                        }
                        //-----------------------------
                        var after_submit=function(){
                            if(m.after_update!=undefined){
                                m.after_update(data,res); return;
                            }
                            $vm.refresh=1;
                            //if(m.change_status==undefined) m.change_status=0;
                            m.change_status++;
                            if(rid!=undefined) window.history.go(-1);                       //modify
                        }
                        //-----------------------------
                        if(FN==0) after_submit();
                        else{
                            open_model__ID();
                            $vm.upload_form_files(res,$('#F__ID'),"msg__ID",function(){
                                close_model__ID();
                                after_submit();
                            })
                        }
                        //-----------------------------
                    });
                }
            }
            //--------------------------------------------------------
            $('#D__ID').on('load',function(){ m.load();})
            $('#F__ID').submit(function(event){
                m.submit(event);})
            //--------------------------------------------------------
            $('#delete__ID').on('click', function(){
                var record=m.input.record;    if(record==undefined) return;
                var rid=record._id;           if(rid==undefined)    return;
                if(confirm("Are you sure to delete?\n")){
                    var d_cmd="delete";
                    if(m.cmd_type=='table') cmd='delete-table';
                    $vm.request({cmd:d_cmd,id:rid,table:m.Table},function(res){
                        //-----------------------------
                        if(res.status=="lk"){
                            $vm.alert("This record is locked.");
                            return;
                        }
                        //-----------------------------
                        if(res.status=="np"){
                            alert("No permission to delete this record.");
                            return;
                        }
                        //-----------------------------
                        if(m.after_delete!=undefined){
                            m.after_delete(res); 
                            return;
                        }
                        //-------------------------------
                        $vm.refresh=1;
                        //if(m.change_status==undefined) m.change_status=0;
                        m.change_status++;
                        window.history.go(-1);
                    });
                }
            })
            //-------------------------------------
            $('#copy__ID').on('click',function(){
                if($vm.copy_paste==undefined) $vm.copy_paste={}
                $vm.copy_paste['__ID']={Data:$vm.serialize('#F__ID')};
                console.log($vm.copy_paste['__ID'])
            })
            //---------------------------------------------
            $('#paste__ID').on('click',function(){
                if($vm.copy_paste!=undefined && $vm.copy_paste['__ID']!=null){
                    $vm.deserialize($vm.copy_paste['__ID'],'#F__ID');
                    if(m.paste!=undefined) m.paste($vm.copy_paste['__ID']);
                }
            })
            //---------------------------------------------
            $('#header__ID').on('click', function(event){
                if(event.ctrlKey){
                    var x=document.getElementById("F__ID");
                    var txt="";var nm0="";
                    for (var i=0; i < x.length; i++) {
                        var nm=x.elements[i].getAttribute("name");
                        if(nm!=null && nm!=nm0){ if(txt!="") txt+=", "; txt+=nm; nm0=nm;}
                    }
                    console.log(txt);
                }
            });
            //--------------------------------------------------------
            $('#pdf__ID').on('click',function(){
                $('#D__ID').scrollTop(0);
                $(window).scrollTop(0);
                var h=$('#D__ID').css('height');
                $('#D__ID').css('height',"210mm");
                $('form_container__ID').css('height',"297mm");
                $('#F__ID').css('border-bottom-width','0');
                $('#submit__ID').hide();
                $('#pdf__ID').hide();
                var pdf=new jsPDF('p', 'pt', 'a4');
                //pdf.internal.scaleFactor = 2.25;
                var options = {
                    //pagesplit: true,
                    background: '#fff'
                };
                pdf.addHTML($('#form_container__ID'),options,function() {
                    pdf.save(m.Table+'.pdf');
                    $('#F__ID').css('border-bottom-width','1px');
                    $('#submit__ID').show();
                    $('#pdf__ID').show();
                    $('#D__ID').css('height',h);
                });
                
            })
          //-------------------------------------
			//var before_submit = m.before_submit;
            console.log('AAAAAAAAAAAAAAAAAAAA')
			m.before_submit = function (data, index) {
                console.log(before_submit)
                var count=0;
                if($('#email_address__ID').val()=="" || $('#email_address__ID').val()==undefined ) {$vm.alert("No email entered"); return false;}
                var tb = 'comeback-email-address'
                var qry = {'Data.email_address':$('#email_address__ID').val()};
                jQuery.ajaxSetup({async:false});
                $vm.request({ cmd: "find", table: tb, query: qry, options: {} }, function (res) {
                    count=res.result.length;
                })
                jQuery.ajaxSetup({async:true});
                if (count > 0) {console.log('B'+count);$vm.alert("Duplicated Email");return false;}
                console.log('A'+count);
                return before_submit(data, index);
    		}
}
        //------------------------------------
        $vm.footer_ready=1;
        //------------------------------------

    </script>

    <style>
   		#D__ID .vlf {
			border-left: 1px solid rgb( 0,0,0,0.3);
			height: 150px;
			position: absolute;
            left:0;
			top: 0;
		}

        #D__ID{
            overflow: hidden;
        }
        #D__ID .fontem{
            font-size: 17px;
            font-weight:normal;
            color:black;
        }
        #D__ID .fontems{
            font-size: 12px;
            font-weight:normal;
            color:black;
        }
        #D__ID .fontfot{
            font-size: 15px;
            font-weight:normal;
            color:black;
            margin:0;
            letter-spacing: 0.2rem;
        }
        #D__ID #submit__ID{
            cursor:pointer;
        }
        hr{
            margin-top: 1rem;
            margin-bottom: 1rem;
            border: 0;
            border-top: 2px solid rgba(0, 0, 0, 0.3);
            margin-left: 30px;
            margin-right: 30px;
        }
        #footer__ID a{
            color: #fff;
            font-size:120%;
            margin-right:10px;
        }
        #footer__ID{
            font-family: "Montserrat";
            /*height:90px;*/
            overflow: hidden;
            color: #000;
            padding: 12px;
            background-color: rgb(233, 230, 222);
            font-size:100%;
            text-align: center;
        }
        #footer__ID .fa-stack-1x {
            color:white;
        }
        #footer__ID .icon-facebook {
        color:#3b5998;
        }

        #footer__ID .icon-twitter {
            color:#00aced;
        }

        #footer__ID .icon-gplus{
            color:#dd4b39;
        }
        #footer__ID .questiongroup-footer{
            text-align:left;
        }
        #footer__ID .form-control-footer{
            display: block;
            width: 100%;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;            
        }
        @media screen and (max-width: 1200px){
            #footer__ID{ height:auto; }
        }
    </style>
</div>
